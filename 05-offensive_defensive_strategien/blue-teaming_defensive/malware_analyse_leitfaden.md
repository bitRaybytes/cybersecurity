# Leitfaden zur Malware Analyse

## Inhaltsverzeichnis
- [Einleitung](#einleitung)
- [Stufe 1: Basis-Analyse (Triage)](#stufe-1-basis-analyse-triage)
    - [Checksum (Hash-Werte)](#checksum-hash-werte)
    - [Rolle in der Analyse](#rolle-in-der-analyse)
    - [G√§ngige Hash-Algorithmen](#g√§ngige-hash-algorithmen)
    - [Online Sandboxing](#online-sandboxing)
    - [Virus Total](#virus-total)
- [Stufe 2: Statische Analyse](#stufe-2-statische-analyse)
    - [Dateityp und Header-Analyse](#dateityp-und-header-analyse)
    - [String-Extraktion](#string-extraktion)
    - [Packer- und Obfuskationserkennung](#packer--und-obfuskationserkennung)
- [Stufe 3: Dynamische Analyse (Verhaltensanalyse)](#stufe-3-dynamische-analyse-verhaltensanalyse)
    - [Isolierte Umgebung (The Lab)](#isolierte-umgebung-the-lab)
    - [√úberwachungsbereiche](#√ºberwachungsbereiche)
    - [Debugging](#debugging)
- [N√ºtzliche Links](#n√ºtzliche-links)
- [Haftungsausschluss](#haftungsausschluss)


<div align=right>

[‚Üë Inhaltsverzeichnis](#inhaltsverzeichnis)

</div>

## Einleitung
Die **Malware Analyse** ist ein zentraler Baustein der **Blue-Team-Aktivit√§ten** und der gesamten Incident Response. Ihr Kernziel ist es, schadhafte Programme (Malware) schnell und systematisch zu verstehen, um geeignete Abwehrma√ünahmen (Signaturerstellung, Blacklisting von Command & Control-Servern) f√ºr die eigenen Organisationsstrukturen zu entwickeln.

Es gibt verschiedene Methoden, die in zwei Hauptkategorien unterteilt werden: **Statische** und **Dynamische** Analyse.


```text
+------------------------------------+
| 1. Triage (Vorbewertung)           |
| (Hash-Pr√ºfung, Sandboxing)         |
+------------------+-----------------+
                   |
                   V
+------------------+-----------------+
| 2. Statische Analyse               |
| (Strings, Header, Imports/Exports) |
+------------------+-----------------+
                   |
                   V
+------------------+-----------------+
| 3. Dynamische Analyse              |
| (Sandbox / Labor: Monitoring, C2)  |
+------------------+-----------------+
                   |
                   V
+------------------+--------------------+
| 4. Berichterstellung & Gegenma√ünahmen |
| (IOCs, Signaturerstellung, Defense)   |
+---------------------------------------+ 
```



<div align=right>

[‚Üë Inhaltsverzeichnis](#inhaltsverzeichnis)

</div>

## Stufe 1: Basis-Analyse (Triage)

Diese erste Stufe dient der schnellen Identifizierung und Risikobewertung.


<div align=right>

[‚Üë Inhaltsverzeichnis](#inhaltsverzeichnis)

</div>


### Checksum (Hash-Werte)
Ein **Checksum** (Hash-Wert) ist das Resultat einer mathematischen Berechnung, bei der eine Eingabe (die Datei) mit einem kryptografischen Algorithmus (z. B. SHA256) verschl√ºsselt wird, sodass eine einzigartige, fixe Zeichenfolge entsteht.



<div align=right>

[‚Üë Inhaltsverzeichnis](#inhaltsverzeichnis)

</div>

### Rolle in der Analyse
- **Identifikation:** Ein Hash-Wert dient als digitaler Fingerabdruck. Ist er in einer **Threat Intelligence** (**TI**) Datenbank bekannt, kann die Malware schnell identifizieren und klassifiziert werden (z.B als "Emotet Loader")

- **Integrit√§tspr√ºfung:** Best√§tigt, dass die analyiserte Datei w√§hrend der √úbertragung nicht ver√§ndert wurde.


<div align=right>

[‚Üë Inhaltsverzeichnis](#inhaltsverzeichnis)

</div>


### G√§ngige Hash-Algorithmen
| Algorithmus | L√§nge (Bits) | L√§nge (Hex-Zeichen) | Verwendung |
| :--- | :--- | :--- | :--- |
| MD5 | 128 | 32 | Veraltet (Kollisionen m√∂glich), aber noch h√§ufig genutzt. |
| SHA-1 | 160 | 40 | Veraltet (Kollisionen m√∂glich). |
| SHA-256 | 256 | 64 | Aktueller Standard f√ºr Malware-Identifikation. |



<div align=right>

[‚Üë Inhaltsverzeichnis](#inhaltsverzeichnis)

</div>


### Online Sandboxing
Sandboxing ist die Ausf√ºhrung der Malware in einer isolierten, sicheren virtuellen Umgebung, um ihr Verhalten zu beobachten, ohne das Host-System zu gef√§hrden.

| **Vorteile** | **Nachteile** |
|--------------|---------------|
| **Automatisierung:** Liefert schnell einen ersten Bericht √ºber das Verhalten der Malware (Dateierstellung, Registry-√Ñnderung, Netzwerkverbindungen). | Viele Malware-Varianten erkennen, wenn sie in einer Sandbox ausgef√ºhrt werden, und bleiben inaktiv (**Sandobox Evasion**). | 
| **IOC-Extraktion:** Extrahiert sofort **Indicators of Compromise** (**ICOs**) wie IP-Adressen und Domain-Namen der Command & Control (C2) Server | |


<div align=right>

[‚Üë Inhaltsverzeichnis](#inhaltsverzeichnis)

</div>


### Virus Total
[Virus Total](https://www.virustotal.com/gui/home/upload) ist eine √∂ffentliche Online-Plattform, die die Malware-Probe durch Dutzende verschiedener Antiviren-Engines analysiert und die Ergebnisse bereitstellt.

- **Nutzen:**
  - **Ersteinsch√§tung:** Zeigt, wie viele Hersteller die Datei als sch√§dlich einstufen.
  - **Community-Beitr√§ge:** Bietet oft statische Informationen (PE-Header-Daten) und Kommentare von anderen Analysten.



<div align=right>

[‚Üë Inhaltsverzeichnis](#inhaltsverzeichnis)

</div>


## Stufe 2: Statische Analyse
Die statische Analyse untersucht die Malware-Datei **ohne sie auszuf√ºhren**. Sie konzentriert sich auf die internen Daten und die Struktur der Datei.



<div align=right>

[‚Üë Inhaltsverzeichnis](#inhaltsverzeichnis)

</div>


### Dateityp und Header-Analyse
Die Untersuchung des **PE-Headers** (**Portable Executable**) - des Standardformats f√ºr Windows-Ausf√ºhrungsdateien - gibt Aufschluss √ºber:

- **Kompilierungszeitstempel:** Kann Hinweise auf das Alter der Malware geben (oft gef√§lscht).
- **Architektur:** 32-Bit oder 64-Bit.
- **Sektionen:** Zeigt, wie der Code organisiesrt ist (z.B. `.text` f√ºr Code, `.data`f√ºr initialisierte Daten).
- **Importierte Funktionen (Imports):** Die von der Malware genutzten System-APIs. Dies ist ein wichtiger Indikator f√ºr ihre Absicht (z. B. `WriteFile` deutet auf Dateimanipulation hin, `WSAConnect` auf Netzwerkkommunikation).



<div align=right>

[‚Üë Inhaltsverzeichnis](#inhaltsverzeichnis)

</div>


### String-Extraktion
Das Extrahieren aller lesbaren Textketten (Strings) aus der Bin√§rdatei kann schnell verrwertbare Informationen liefern:

- **Dateinamen:** Name, die die Malware erstellt oder sucht.
- **Registry-Schl√ºssel:** Schl√ºssel, die f√ºr Persistenz verwendet werden (z. B. `Run` Schl√ºssel).
- **IP-Adressen/URLs:** Potentielle C2-Server-Adressen.
- **Fehlermeldungen oder Mutex-Namen** (**Mu**tual **Ex**clusion).

  
> Ein **Mutex-Namen** ist die Bezeichnung f√ºr eine benannte Sperre (Mutex), die es mehreren Prozessen oder Threads erm√∂glicht, einen gemeinsamen Ressourcenzugriff √ºber den Namen zu synchronisieren und so Konflikte zu verhindern.



<div align=right>

[‚Üë Inhaltsverzeichnis](#inhaltsverzeichnis)

</div>


### Packer- und Obfuskationserkennung
Viele Sch√§dliche Programme verwenden **Packer** (wie UPX oder Themidia), um ihren Code zu verschleiern (**Obfuskation**).

- **Erkennung:** Wenn der PE-Header ungew√∂hnliche Sektionen oder stark komprimierte Sektionen aufweist.
- **Ma√ünahmen:** Die Walware muss zun√§chst entpackt werden, bevor eine tiefere Analyse m√∂glich ist.



<div align=right>

[‚Üë Inhaltsverzeichnis](#inhaltsverzeichnis)

</div>


## Stufe 3: Dynamische Analyse (Verhaltensanalyse)
Die dynamische Analyse beinhaltet die **Ausf√ºhrung der Malware in einer isolierten Umgebung (Malware Lab)**, um ihr tats√§chliches Verhalten und ihre Interaktionen mit dem Betriebssystem zu beobachten.


<div align=right>

[‚Üë Inhaltsverzeichnis](#inhaltsverzeichnis)

</div>


### Isolierte Umgebung (The Lab)

- Dies muss eine **virtuelle Maschine** sein, die vom Host-Netzwerk getrennt ist (**Air-Gapped**) oder nur √ºber ein simuliertes Internet verf√ºgt, um eine Infektion zu verhindern.

- **Wichtige Tools:** **Fiddler/Wireshark** (Netzwerkverkehr), **Procmon/Regshot** (Dateisystem/Registry-√Ñnderungen), **Debugger** (z. B. x64dbg).



<div align=right>

[‚Üë Inhaltsverzeichnis](#inhaltsverzeichnis)

</div>


### √úberwachungsbereiche
| Bereich | Beobachtete Aktivit√§ten | Extrahiertes IOC |
|---------|-------------------------|------------------|
| **Prozesse** | Start neuer Prozesse, Prozess-Injektion (Code-Injection) in legitime Prozesse. | PID, injizierter Code. |
| **Dateisystem** | Erstellung, L√∂schung oder Modifikation von Dateien. | Pfade zu Dropper-Dateien, Konfigurationsdateien. |
| **Registry** | Hinzuf√ºgen von **Persistenz-Schl√ºssel** (z. B. in `HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run`). |
| **Netzwerkverkehr** | Kommunikation mit externen Servern, DNS-Anfragen. | IP-Adressen, Domain-Namen, Ports, Protokoll (z. B. HTTPS, DNS). |



<div align=right>

[‚Üë Inhaltsverzeichnis](#inhaltsverzeichnis)

</div>


### Debugging
- Bei komplexer Malware (oder bei Obfuskation) ist das **Debugging** der letzte Schritt. Hierbei wird der Code schrittweise ausgef√ºhrt, um die Programmlogik, Entschl√ºsselungsroutinen oder Anti-Analyse-Checks zu verstehen.


<div align=right>

[‚Üë Inhaltsverzeichnis](#inhaltsverzeichnis)

</div>


## N√ºtzliche Links
- [Hybrid Analysis - Freies Malware Analyse Tool (online)](https://hybrid-analysis.com/)
- [HexEd.it - Online Hex-Editor](https://hexed.it/)
- [ANY.RUN - interaktive Online-Malware-Sandbox](https://any.run/)
- [PEStudio - Freies Tool zur PE-Header-Analyse](https://www.winitor.com/)
- [Microsoft Process Monitor (Procmon) - Unverzichtbar f√ºr die dynamische Analyse](https://learn.microsoft.com/en-us/sysinternals/downloads/procmon)
- [TryHackMe Room: MAL: Researching](https://tryhackme.com/room/malresearching)



<div align=right>

[‚Üë Inhaltsverzeichnis](#inhaltsverzeichnis)

</div>


## Haftungsausschluss

Dieses Repository dient ausschlie√ülich zu Ausbildungs-, Forschungs- und Demonstrationszwecken im Bereich der IT-Sicherheit.

Alle hier dokumentierten Techniken und Tools d√ºrfen nur in legalen und autorisierten Testumgebungen verwendet werden ‚Äì z.‚ÄØB. in Labors, CTFs oder mit ausdr√ºcklicher Genehmigung des Eigent√ºmers der Zielsysteme.

Wir distanzieren uns ausdr√ºcklich von jeglicher illegalen Nutzung.
Dieses Projekt richtet sich an White-Hat-Sicherheitsforscher, Ethical Hacker und Auszubildende, die ethisch und rechtlich korrekt handeln.

[Disclaimer](/00-disclaimer/disclaimer.md)

---

Stay curious ‚Äì stay secure. üîê

üóìÔ∏è **Letzte Aktualisierung:** September 2025  
ü§ù **Pull Requests willkommen** ‚Äì Vorschl√§ge f√ºr neue Kurse oder Kategorien gerne einreichen!

---