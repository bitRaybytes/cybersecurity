# üõ°Ô∏è Sudoers-Bypass-Analyse: CVE-2019-14287


## Inhaltsverzeichnis
- [Einleitung](#einleitung)
- [Erh√∂hung der Privilegien durch fehlerhafte UID-Validierung](#erh√∂hung-der-privilegien-durch-fehlerhafte-uid-validierung)
    - [1. √úberblick und Klassifizierung](#1-√ºberblick-und-klassifizierung)
    - [2. Funktionsweise und Technische Details](#2-funktionsweise-und-technische-details)
    - [3. Penetration Test: Validierung des Exploits](#3-penetration-test-validierung-des-exploits)
    - [4. Gegenma√ünahmen und Patches](#4-gegenma√ünahmen-und-patches)
- [N√ºtzliche Links](#n√ºtzliche-links)
- [Haftungsausschluss](#haftungsausschluss)



<div align=right>

[‚Üë Inhaltsverzeichnis](#inhaltsverzeichnis)

</div>


## Einleitung
Du kannst auf **tryhackme.com** den Raum [Sudo Security Bypass](https://tryhackme.com/room/sudovulnsbypass) besuchen, um mehr √ºber diese Schwachstelle zu erfahren und sie in den eigenen Labs ausprobieren.



<div align=right>

[‚Üë Inhaltsverzeichnis](#inhaltsverzeichnis)

</div>


## Erh√∂hung der Privilegien durch fehlerhafte UID-Validierung
### 1. √úberblick und Klassifizierung


| Attribut | Wert |
|----------|------|
| CVE-ID | CVE-2019-14287 |
| Kategorie | Privilege Escalation (PE) |
| Betroffenes Produkt | Sudo (Versionszweig 1.8.28 und √§lter) |
| Schweregrad (CVSS v3.1) | 9.8 (Critical) |
| Schwachstellentyp | Improper Input Validation (Fehlerhafte Eingabevalidierung) |
| Ben√∂tigte Konfiguration | Spezifische `sudoers`-Regel (`!root`-Ausschluss) |


<div align=right>

[‚Üë Inhaltsverzeichnis](#inhaltsverzeichnis)

</div>


### 2. Funktionsweise und Technische Details
#### 2.1 Der Kern der Schwachstelle

Die Schwachstelle beruht auf einem Fehler in der Validierungslogik des `sudo`-Befehls beim Parsen einer numerischen Benutzer-ID (UID), die √ºber die Option `-u` angegeben wird.

Normalerweise erlaubt die `sudoers`-Konfiguration dem Administrator, Regeln zu definieren, die es einem Benutzer gestatten, Befehle als eine beliebige andere UID auszuf√ºhren, mit Ausnahme einer explizit ausgeschlossenen UID (z. B. `root`).

Wenn ein Benutzer die Option `-u` verwendet, um eine numerische ID (`#UID`) anzugeben, wird diese ID von `sudo` in eine interne Variable konvertiert. Wenn der Benutzer die numerische ID `-1` oder ihren √§quivalenten, nicht signierten 32-Bit-Wert `4294967295` (entsprechend `0xFFFFFFFF`) angibt, interpretiert `sudo` diesen Wert intern als **0**, also die Root-UID.


<div align=right>

[‚Üë Inhaltsverzeichnis](#inhaltsverzeichnis)

</div>


#### 2.2 Bedingung f√ºr die Ausnutzung

Die Ausnutzung ist nur m√∂glich, wenn die `sudoers`-Datei eine Regel enth√§lt, die den Benutzer zwar zur Ausf√ºhrung von Befehlen als alle Benutzer berechtigt, aber explizit die Root-UID ausschlie√üt.

Typische anf√§llige Regel in `/etc/sudoers`:

```text
user_name ALL=(ALL, !root) NOPASSWD: /path/to/command
```

In diesem Fall glaubt `sudo`, dass es die `!root`-Bedingung korrekt durchsetzt, wenn es die ID des Zielbenutzers pr√ºft. Da die numerische Angabe von `-1` intern zu `0` (root) konvertiert wird, wird diese Pr√ºfung jedoch umgangen, und der Befehl wird als Root ausgef√ºhrt.


<div align=right>

[‚Üë Inhaltsverzeichnis](#inhaltsverzeichnis)

</div>


#### 2.3 Schematische Darstellung des Bypass

```text
+------------------+           +------------------+
|    User Input    |           | Sudo Validation  |
+------------------+           +------------------+
| sudo -u#-1 cmd   | --------> | target_uid = -1  |
+------------------+           +------------------+
                                       |
                                       V
                               +-------------------+
                               | Sudo Internal Map |
                               +-------------------+
                               | unsigned(-1) = 0  |  <--- **BYPASS**
                               | (Root UID)        |
                               +-------------------+
                                       |
+-------------------------------------------------------+
|               ACL Check: "Is target_uid != root?"     |
|  (Rule: ALL, !root)          |                        |
|  Check: 0 != 0?              | NO -> Exclusion Fails  |
|  Result: Execute as Root     |                        |
+-------------------------------------------------------+
```


<div align=right>

[‚Üë Inhaltsverzeichnis](#inhaltsverzeichnis)

</div>


### 3. Penetration Test: Validierung des Exploits
#### 3.1 Zielsystem-Analyse (`sudo -l`)

Ziel der Analyse: Pr√ºfen, ob eine anf√§llige `sudoers`-Regel existiert.

| Schritt | Befehl | Analyse |
|---------|--------|---------|
| 1. | `sudo -l` | √úberpr√ºfung der dem aktuellen Benutzer zugewiesenen `sudo`-Rechte. |
| 2. | Erkannte Regel | `(ALL, !root) NOPASSWD: /bin/bash` |
| 3. | Validierung | Die Regel entspricht der anf√§lligen Konfiguration: Der Benutzer darf alle Befehle als alle Benutzer au√üer Root ausf√ºhren. |


<div align=right>

[‚Üë Inhaltsverzeichnis](#inhaltsverzeichnis)

</div>


#### 3.2 Exploitation des Privilegien-Bypass

Ziel der Ausf√ºhrung: Den zugewiesenen Befehl (`/bin/bash`) unter Umgehung des `!root`-Ausschlusses als Root (UID 0) starten, um Root-Dateien zu lesen.

| Schritt | Befehl | Erwartetes Ergebnis | Tats√§chliches Ergebnis |
|---------|--------|---------------------|------------------------|
| 1. | `sudo -u#-1 bash /root/root.txt` | Der Befehl sollte aufgrund der `!root`-Regel fehlschlagen. | Der Befehl wird als Root ausgef√ºhrt, die Datei `/root/root.txt` wird gelesen. |




<div align=right>

[‚Üë Inhaltsverzeichnis](#inhaltsverzeichnis)

</div>


#### Nachweis der erfolgreichen Ausnutzung:

Durch die erfolgreiche Ausgabe des Dateiinhalts von `/root/root.txt` wurde die Privilege Escalation von einem normalen Benutzer auf Root-Rechte erfolgreich demonstriert und verifiziert. Der Bypass √ºber die UID `# -1` hat die `sudoers`-Regel `!root` effektiv negiert.

![Anf√§llige Sudoers-Regel](./assets/cve-2019-14287-screenshot-01.png)


<div align=right>

[‚Üë Inhaltsverzeichnis](#inhaltsverzeichnis)

</div>



### 4. Gegenma√ünahmen und Patches

Die Schwachstelle [CVE-2019-14287](https://www.cve.org/CVERecord?id=CVE-2019-14287) wurde durch die Korrektur der Eingabevalidierung in der `sudo`-Software behoben.

Empfehlung:

- **Aktualisierung:** Sofortiges Update von `sudo` auf Version 1.8.29 oder h√∂her.

- **Konfigurations-H√§rtung:** Obwohl gepatcht, sollte die Verwendung von `(ALL, !root)`-Regeln in Produktionsumgebungen als hochriskant betrachtet und vermieden werden, da sie ein hohes Missbrauchspotenzial aufweisen.




## N√ºtzliche Links
- [TryHackeMe: Sudo Security Bypass](https://tryhackme.com/room/sudovulnsbypass)


<div align=right>

[‚Üë Inhaltsverzeichnis](#inhaltsverzeichnis)

</div>


## Haftungsausschluss

Dieses Repository dient ausschlie√ülich zu Ausbildungs-, Forschungs- und Demonstrationszwecken im Bereich der IT-Sicherheit.

Alle hier dokumentierten Techniken und Tools d√ºrfen nur in legalen und autorisierten Testumgebungen verwendet werden ‚Äì z.‚ÄØB. in Labors, CTFs oder mit ausdr√ºcklicher Genehmigung des Eigent√ºmers der Zielsysteme.

Wir distanzieren uns ausdr√ºcklich von jeglicher illegalen Nutzung.
Dieses Projekt richtet sich an White-Hat-Sicherheitsforscher, Ethical Hacker und Auszubildende, die ethisch und rechtlich korrekt handeln.

[Disclaimer](/00-disclaimer/disclaimer.md)

--- 

Stay curious ‚Äì stay secure. üîê

üóìÔ∏è **Letzte Aktualisierung:** Oktober 2025  
ü§ù **Pull Requests willkommen** ‚Äì Vorschl√§ge f√ºr neue Kurse oder Kategorien gerne einreichen!

---